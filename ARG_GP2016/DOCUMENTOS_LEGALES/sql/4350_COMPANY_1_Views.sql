/*Count : 1 */
 
set DATEFORMAT ymd 
GO 
 
/*Begin_XDL90101*/
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[XDL90101]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[XDL90101]
GO

CREATE VIEW [dbo].[XDL90101] AS 
SELECT TOP 100 PERCENT dbo.XDL10101.XDL_Tipo_Documento, dbo.XDL91101.NroCpbte,dbo.XDL10101.XDL_DocNumber,
 dbo.XDL91101.Letra, dbo.XDL90100.XDLNUCO, dbo.XDL91101.ERMSGTXT ,
dbo.XDL90100.XDLCPDS, dbo.XDL90100.XDLDSCFG, dbo.XDL91101.XDLNULINE, dbo.XDL91101.Remito, 
dbo.XDL91101.Estado, dbo.XDL91101.SERLTNUM, 
dbo.XDL91101.SERLTQTY, dbo.XDL91101.Cantidad, dbo.XDL91101.Cliente, 
dbo.XDL91101.CodPost, dbo.XDL91101.CodPostCom,
dbo.XDL91101.Comentario, dbo.XDL91101.Compania, dbo.XDL91101.CondPago, 
dbo.nfRFC_SY00101.NFRFCDSCPT AS IVACOND, dbo.XDL91101.CUIT, 
dbo.XDL91101.CUITCom, dbo.XDL91101.CUITIIBB, dbo.XDL91101.Descuento, dbo.XDL91101.DetArt, 
dbo.XDL91101.DirCom, dbo.XDL91101.Direccion, dbo.XDL91101.DirOrig, 
dbo.XDL91101.DirOrigArt, dbo.XDL91101.EstadoCom, dbo.XDL91101.FaxCom, dbo.XDL91101.FecCpbte, dbo.XDL91101.ImpArt,
dbo.XDL91101.Impuestos, dbo.XDL91101.Linea, dbo.XDL91101.LocaCom, dbo.XDL91101.Localidad, dbo.XDL91101.NroArt, dbo.XDL91101.OrdCpra,
dbo.XDL91101.Pais, dbo.XDL91101.PaisCom, dbo.XDL91101.PrecUnitArt, dbo.XDL91101.RazSocial, dbo.XDL91101.TelefonoCom,
dbo.XDL91101.Territorio, dbo.XDL91101.TerritorioArt, dbo.XDL91101.Tipo, dbo.XDL91101.TotalArt, dbo.XDL91101.Unidad, dbo.XDL91101.Usuario,
dbo.XDL91101.Vendedor, dbo.XDL91101.VendedorArt, dbo.XDL91101.CURNCYID, DYNAMICS.dbo.MC40200.CRNCYDSC, dbo.XDL91101.CURRNIDX,
dbo.XDL91101.NOTEINDX, dbo.XDL91101.SHIPMTHD, dbo.XDL91101.XCHGRATE, dbo.XDL91101.EXCHDATE,
dbo.SY03900.TXTFIELD AS RecNoteMSTR, dbo.XDL10112.XDLTRANS AS Transport, dbo.XDL10112.XDLCondu AS Conduct,
dbo.XDL10112.XDLDire AS DireTrans, dbo.XDL10112.XDLChapa1 AS PCamion, dbo.XDL10112.XDLChapa2 AS PAcopl,
dbo.XDL10112.XDL_Camion AS TCamioin, dbo.XDL10112.XDLUDef AS TUsrDfned, dbo.SOP10106.USERDEF1, dbo.SOP10106.USERDEF2,
dbo.SOP10106.CMMTTEXT AS CommMaster,
ISNULL(dbo.XDL10114.XDLCAEAuthorizationCode ,ISNULL(dbo.XDL10115.XDLCAEAuthorizationCode,'') ) as XDLCAEAuthorizationCode,
case when dbo.XDL10114.XDL_DueDate >='01-01-1965' then XDL10114.XDL_DueDate 
when dbo.XDL10115.XDL_DueDate >='01-01-1965' then XDL10115.XDL_DueDate END as XDL_DueDate,
(SELECT SUM(XDL.TotalArt + XDL.ImpArt) AS TOTALITEM FROM XDL91101 XDL INNER JOIN
XDL91101 XDL2 ON XDL.NroCpbte = XDL2.NroCpbte AND XDL.Letra = XDL2.Letra AND XDL.Linea = XDL2.Linea AND
XDL.Usuario = XDL2.Usuario AND XDL.Tipo = XDL2.Tipo) AS SUBTOTCIMP, BILLTO.ADDRESS1 AS BILLADDRESS1,
BILLTO.ADDRESS2 AS BILLADDRESS2, BILLTO.ADDRESS3 AS BILLADDRESS3, BILLTO.COUNTRY AS BILLCOUNTRY, BILLTO.CITY AS BILLCITY,
BILLTO.STATE AS BILLSTATE, BILLTO.ZIP AS BILLZIP, SHIPTO.ADDRESS1 AS SHIPADDRESS1, SHIPTO.ADDRESS2 AS SHIPADDRESS2,
SHIPTO.ADDRESS3 AS SHIPADDRESS3, SHIPTO.COUNTRY AS SHIPCOUNTRY, SHIPTO.CITY AS SHIPCITY, SHIPTO.STATE AS SHIPSTATE,
SHIPTO.ZIP AS SHIPZIP, dbo.XDL90100.USERID, dbo.XDL90100.SOPTYPE, dbo.XDL90100.SUBTOTAL, dbo.XDL90100.TAXAMNT,
dbo.XDL90100.DOCAMNT AS Total, dbo.XDL90100.XDLDSTOTAL, ISNULL(dbo.IV00301.LOTATRB1, '') AS LOTATRB1, ISNULL(dbo.IV00301.LOTATRB2,
'') AS LOTATRB2, ISNULL(dbo.IV00301.LOTATRB3, '') AS LOTATRB3, dbo.XDL90100.FUNLCURR, dbo.RM00101.USERDEF1 AS CUSTNINV, 
dbo.RM00101.USERDEF2 AS CUSTIIBB, dbo.XDL10101.XDL_Impresiones_Factura, ISNULL((SELECT TABLA.XCHGRATE FROM DYNAMICS.dbo.MC00100 TABLA INNER JOIN
(SELECT M.EXGTBLID, M.CURNCYID, M.RATETPID FROM MC40301 M INNER JOIN RM00101 R ON (M.CURNCYID = R.CURNCYID AND 
M.RATETPID = R.RATETPID AND R.CUSTNMBR = XDL91101.Cliente)) AS MONEDA ON (TABLA.EXGTBLID = MONEDA.EXGTBLID AND 
TABLA.CURNCYID = MONEDA.CURNCYID) WHERE TABLA.EXCHDATE = XDL91101.FecCpbte), 0) AS TASACAMBIO, ISNULL
((SELECT EQUOMQTY FROM IV40202 WHERE UOFM = XDL91101.Unidad AND UOMSCHDL = 'KG'), 0) AS REFKG, 
dbo.SY01200.INETINFO, dbo.XDL90100.XDL_CAI,dbo.XDL90100.XDL_CAI_Due_Date, dbo.XDL91101.ORIGNUMB, dbo.XDL10112.XDLDocNum 
AS NDocumento, dbo.IV40700.LOCNDSCR,dbo.IV40700.ADDRESS1, dbo.IV40700.CITY, dbo.IV40700.STATE, dbo.IV40700.ZIPCODE, 
dbo.IV40700.COUNTRY, dbo.IV40700.PHONE1,dbo.IV40700.FAXNUMBR, dbo.IV00101.USCATVLS_1, dbo.XDL90100.ORTAXAMT, 
dbo.XDL90100.ORDOCAMT, dbo.XDL91101.ORUNTPRC,dbo.XDL91101.OXTNDPRC, dbo.XDL91101.ORTAXAMT AS ORTAXAMT_LINE
FROM dbo.SY03900 RIGHT OUTER JOIN
dbo.SOP10106 RIGHT OUTER JOIN
dbo.IV00301 RIGHT OUTER JOIN
dbo.SY01200 RIGHT OUTER JOIN
dbo.RM00101 ON dbo.SY01200.ADRSCODE = dbo.RM00101.ADRSCODE AND dbo.SY01200.Master_ID = dbo.RM00101.CUSTNMBR RIGHT OUTER JOIN
DYNAMICS.dbo.MC40200 RIGHT OUTER JOIN
dbo.XDL90100 INNER JOIN
dbo.XDL91101 ON dbo.XDL90100.SOPTYPE = dbo.XDL91101.Tipo AND dbo.XDL90100.USERID = dbo.XDL91101.Usuario AND 
dbo.XDL90100.XDL_GP_DocNumber = dbo.XDL91101.NroCpbte INNER JOIN
dbo.IV40700 ON dbo.XDL91101.DirOrig = dbo.IV40700.LOCNCODE LEFT OUTER JOIN
dbo.IV00101 ON dbo.XDL91101.NroArt = dbo.IV00101.ITEMNMBR LEFT OUTER JOIN
dbo.XDL10112 ON dbo.XDL90100.SOPTYPE = dbo.XDL10112.SOPTYPE AND dbo.XDL90100.XDL_GP_DocNumber = dbo.XDL10112.SOPNUMBE ON 
DYNAMICS.dbo.MC40200.CURNCYID = dbo.XDL91101.CURNCYID LEFT OUTER JOIN
dbo.nfRFC_RM00101 ON dbo.XDL91101.Cliente = dbo.nfRFC_RM00101.CUSTNMBR LEFT OUTER JOIN
dbo.nfRFC_SY00101 ON dbo.nfRFC_RM00101.NFRFCTXCOD = dbo.nfRFC_SY00101.NFRFCTXCOD LEFT OUTER JOIN
dbo.XDL10101 ON dbo.XDL90100.XDL_Tipo_Documento = dbo.XDL10101.XDL_Tipo_Documento AND
dbo.XDL90100.XDL_GP_DocNumber = dbo.XDL10101.XDL_GP_DocNumber ON dbo.RM00101.CUSTNMBR = dbo.XDL91101.Cliente ON
dbo.IV00301.ITEMNMBR = dbo.XDL91101.NroArt AND dbo.IV00301.LOTNUMBR = dbo.XDL91101.SERLTNUM ON
dbo.SOP10106.SOPTYPE = dbo.XDL91101.Tipo AND dbo.SOP10106.SOPNUMBE = dbo.XDL91101.NroCpbte ON
dbo.SY03900.NOTEINDX = dbo.XDL91101.NOTEINDX LEFT OUTER JOIN
dbo.XDL10114 on dbo.XDL90100.XDL_GP_DocNumber =  dbo.XDL10114.XDL_DocNumber LEFT OUTER JOIN
dbo.XDL10115 on dbo.XDL90100.XDL_GP_DocNumber =  dbo.XDL10115.XDL_DocNumber LEFT OUTER JOIN
(SELECT  RM.SOPNUMBE,  RM2.CUSTNMBR, ADDRESS1, ADDRESS2, ADDRESS3, COUNTRY, CITY, STATE, ZIP
FROM RM00102 RM2 INNER JOIN
(SELECT SOP1.SOPNUMBE, CUSTNMBR, PRBTADCD
FROM (SOP30200 SOP1 INNER JOIN
XDL91101 XDL ON SOP1.CUSTNMBR = XDL.Cliente )) AS RM ON RM2.ADRSCODE = RM.PRBTADCD AND
RM2.CUSTNMBR = RM.CUSTNMBR
GROUP BY RM.SOPNUMBE, RM2.CUSTNMBR, ADDRESS1, ADDRESS2, ADDRESS3, COUNTRY, CITY, STATE, ZIP) BILLTO ON 
dbo.XDL91101.Cliente = BILLTO.CUSTNMBR and BILLTO.SOPNUMBE = dbo.XDL90100.XDL_DocNumber LEFT OUTER JOIN
(SELECT RM.SOPNUMBE, RM2.CUSTNMBR, ADDRESS1, ADDRESS2, ADDRESS3, COUNTRY, CITY, STATE, ZIP
FROM RM00102 RM2 INNER JOIN
(SELECT  SOP1.SOPNUMBE, CUSTNMBR, PRSTADCD
FROM (SOP30200 SOP1 INNER JOIN
XDL91101 XDL ON SOP1.CUSTNMBR = XDL.Cliente  AND SOP1.SOPNUMBE = XDL.XDL_DocNumber)) AS RM ON
RM2.ADRSCODE = RM.PRSTADCD AND RM2.CUSTNMBR = RM.CUSTNMBR
GROUP BY RM.SOPNUMBE, RM2.CUSTNMBR, ADDRESS1, ADDRESS2, ADDRESS3, COUNTRY, CITY, STATE, ZIP) SHIPTO ON 
dbo.XDL91101.Cliente = SHIPTO.CUSTNMBR and SHIPTO.SOPNUMBE = dbo.XDL90100.XDL_DocNumber
ORDER BY dbo.XDL91101.NroCpbte, dbo.XDL91101.Letra, dbo.XDL90100.XDLNUCO

GO
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

GRANT  SELECT ,  INSERT ,  DELETE ,  UPDATE  ON [dbo].[XDL90101]  TO [DYNGRP] 
GO 

/*End_XDL90101*/